<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal 2FA - Secure Local Authenticator</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="./favicon.svg">
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  
  <link rel="stylesheet" href="./styles/app.css">
  <!-- jsQR Library for QR Code Detection -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
</head>
<body>
  <!-- Security Status Header -->
  <header class="security-header">
    <div class="container">
      <h1 data-i18n="appName">ğŸ”’ Personal 2FA</h1>
      <div class="header-controls">
        <div class="language-selector">
          <select id="language-select" title="Language / Idioma">
            <option value="es">ğŸ‡ªğŸ‡¸ ES</option>
            <option value="en">ğŸ‡ºğŸ‡¸ EN</option>
          </select>
        </div>
        <div class="security-indicators">
          <span class="indicator" id="crypto-status" data-i18n="encryption">ğŸ” Cifrado: AES-256</span>
          <span class="indicator" id="storage-status" data-i18n="storage">ğŸ  Local</span>
          <span class="indicator" id="network-status">ğŸ“¡ Offline âœ…</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Notification System -->
  <div id="notification-container" class="notification-container"></div>

  <!-- Main App Container -->
  <main class="app-container">
    
    <!-- Loading Screen -->
    <section id="loading-screen" class="screen active">
      <div class="loading-card">
        <div class="loading-spinner"></div>
        <h2 data-i18n="loadingTitle">ğŸ” Verificando configuraciÃ³n...</h2>
        <p data-i18n="loadingMessage">Comprobando si ya tienes una contraseÃ±a maestra configurada</p>
      </div>
    </section>
    
    <!-- First Time Setup -->
    <section id="setup-screen" class="screen">
      <div class="setup-card">
        <h2 data-i18n="setupTitle">ğŸ›¡ï¸ ConfiguraciÃ³n Inicial de Seguridad</h2>
        <div class="security-notice">
          <h3 data-i18n="setupSecurity">Esta aplicaciÃ³n es completamente segura:</h3>
          <ul>
            <span data-i18n="setupFeatures.offline">âœ… Funciona 100% offline - Sin conexiones a internet</span><br>
            <span data-i18n="setupFeatures.encrypted">âœ… Todos los datos se cifran antes de guardarse</span><br>
            <span data-i18n="setupFeatures.local">âœ… Tus cÃ³digos nunca salen de tu dispositivo</span><br>
            <span data-i18n="setupFeatures.inspectable">âœ… CÃ³digo fuente completamente inspecciÃ³nable</span><br>
            <span data-i18n="setupFeatures.compatible">âœ… Compatible con Google Authenticator</span>
          </ul>
        </div>
        
        <div class="password-setup">
          <label for="master-password" data-i18n="masterPasswordLabel">Crear contraseÃ±a maestra:</label>
          <input type="password" id="master-password" data-i18n="masterPasswordPlaceholder" placeholder="ContraseÃ±a segura para cifrar tus datos">
          <input type="password" id="confirm-password" data-i18n="confirmPasswordPlaceholder" placeholder="Confirmar contraseÃ±a">
          <button id="setup-complete" class="btn-primary" data-i18n="createVault">ğŸ”’ Crear AlmacÃ©n Seguro</button>
        </div>
      </div>
    </section>

    <!-- Login Screen -->
    <section id="login-screen" class="screen">
      <div class="login-card">
        <h2 data-i18n="loginTitle">ğŸ”“ Desbloquear Personal 2FA</h2>
        <input type="password" id="login-password" data-i18n="loginPlaceholder" placeholder="ContraseÃ±a maestra">
        <button id="login-btn" class="btn-primary" data-i18n="unlockButton">Desbloquear</button>
        <div id="login-error" class="error-message"></div>
      </div>
    </section>

    <!-- Main App Screen -->
    <section id="main-screen" class="screen">
      
      <!-- Action Buttons -->
      <div class="action-bar">
        <button id="import-btn" class="btn-action" data-i18n="importBtn">ğŸ“¥ Importar</button>
        <button id="export-btn" class="btn-action" data-i18n="exportBtn">ğŸ’¾ Exportar Backup</button>
        <button id="add-manual-btn" class="btn-action" data-i18n="addManualBtn">â• AÃ±adir Manual</button>
        <button id="manage-data-btn" class="btn-secondary" data-i18n="manageDataBtn">ğŸ—‘ï¸ Gestionar Datos</button>
        <button id="lock-btn" class="btn-secondary" data-i18n="lockBtn">ğŸ”’ Bloquear</button>
      </div>

      <!-- Import Section -->
      <div id="import-section" class="section hidden">
        <h3 data-i18n="importSectionTitle">ğŸ“± Importar CÃ³digos 2FA</h3>
        
        <!-- JSON Import -->
        <div class="import-method">
          <h4 data-i18n="jsonImportTitle">ğŸ“‹ Importar desde JSON</h4>
          <p data-i18n="jsonImportDesc">Importa cÃ³digos desde un archivo JSON exportado previamente.</p>
          <div class="json-import">
            <input type="file" id="json-file-input" accept=".json" style="display: none;">
            <button id="select-json-file" class="btn-primary" data-i18n="selectJSONFile">ğŸ“‚ Seleccionar Archivo JSON</button>
            <span id="selected-file-name" class="selected-file"></span>
          </div>
        </div>

        <!-- Encrypted Import -->
        <div class="import-method">
          <h4 data-i18n="encryptedImportTitle">ğŸ”’ Importar desde Backup Cifrado</h4>
          <p data-i18n="encryptedImportDesc">Importa cÃ³digos desde un archivo cifrado (compatible con OpenSSL AES-256-CBC).</p>
          <div class="encrypted-import">
            <input type="file" id="encrypted-file-input" accept=".enc,.dat,.bin" style="display: none;">
            <button id="select-encrypted-file" class="btn-primary" data-i18n="selectEncryptedFile">ğŸ“‚ Seleccionar Archivo Cifrado</button>
            <span id="selected-encrypted-file-name" class="selected-file"></span>
          </div>
        </div>

        <!-- QR Import -->
        <div class="import-method">
          <h4 data-i18n="qrImportTitle">ğŸ“± Importar desde QR</h4>
          <p data-i18n="qrImportDesc">Escanea cÃ³digos QR de Google Authenticator u otras apps.</p>
          <div class="qr-scanner">
            <video id="qr-video" autoplay></video>
            <canvas id="qr-canvas" style="display: none;"></canvas>
            <button id="start-camera" class="btn-primary" data-i18n="activateCamera">ğŸ“¹ Activar CÃ¡mara</button>
            <button id="stop-camera" class="btn-secondary hidden" data-i18n="stopCamera">â¹ï¸ Detener</button>
          </div>
        </div>
        
        <div class="scan-status">
          <div id="scan-result"></div>
        </div>
      </div>

      <!-- Export Section -->
      <div id="export-section" class="section hidden">
        <h3 data-i18n="exportSectionTitle">ğŸ’¾ Exportar para Backup</h3>
        <p class="export-notice" data-i18n-html="exportNotice">
          âš ï¸ <strong>Importante:</strong> Este export es solo para backup. 
          Los cÃ³digos NO se guardarÃ¡n en esta app, solo se generan para que puedas importarlos en otra aplicaciÃ³n.
        </p>
        <div class="export-options">
          <button id="export-google-format" class="btn-primary" data-i18n="googleAuthFormat">ğŸ“± Formato Google Authenticator</button>
          <button id="export-individual-qr" class="btn-primary" data-i18n="individualQRs">ğŸ“„ QR Individuales</button>
          <button id="export-json-backup" class="btn-primary" data-i18n="jsonBackup">ğŸ“‹ Backup JSON</button>
          <button id="export-encrypted-backup" class="btn-primary" data-i18n="encryptedBackup">ğŸ”’ Backup Cifrado</button>
        </div>
        <div id="export-result" class="export-result"></div>
      </div>

      <!-- TOTP Codes Display -->
      <div id="codes-section" class="section">
        <h3 data-i18n="codesTitle">ğŸ”¢ CÃ³digos de AutenticaciÃ³n</h3>
        <div id="totp-list" class="totp-list">
          <!-- Los cÃ³digos TOTP se generarÃ¡n aquÃ­ dinÃ¡micamente -->
        </div>
        <div id="empty-state" class="empty-state">
          <p data-i18n="emptyStateMessage">No hay cÃ³digos configurados.</p>
          <p data-i18n="emptyStateSubtext">Importa desde Google Authenticator o aÃ±ade manualmente.</p>
        </div>
      </div>

      <!-- Data Management Section -->
      <div id="data-management-section" class="section hidden">
        <h3 data-i18n="dataManagementTitle">ğŸ—‘ï¸ GestiÃ³n de Datos</h3>
        <div class="data-management-content">
          
          <!-- Developer Options -->
          <div class="dev-options">
            <h4 data-i18n="devOptions">âš™ï¸ Opciones de Desarrollo</h4>
            <div class="option-item">
              <label class="toggle-label">
                <input type="checkbox" id="logs-enabled-toggle">
                <span class="toggle-slider"></span>
                <span class="toggle-text" data-i18n="showDebugLogs">ğŸ“ Mostrar logs de depuraciÃ³n</span>
              </label>
              <p class="option-description" data-i18n="debugDescription">
                Activa los mensajes de depuraciÃ³n en la consola del navegador (desactivado por defecto). 
                Ãštil para desarrolladores y resoluciÃ³n de problemas. Los errores crÃ­ticos siempre se muestran.
              </p>
            </div>
          </div>

          <!-- Danger Zone -->
          <div class="warning-box">
            <h4 data-i18n="deleteAllDataTitle">âš ï¸ Eliminar Todos los Datos</h4>
            <p class="warning-text" data-i18n-html="deleteAllDataWarning">
              Esta acciÃ³n eliminarÃ¡ <strong>permanentemente</strong> todos los cÃ³digos 2FA y datos almacenados, 
              <strong>pero mantiene tu contraseÃ±a maestra y configuraciones bÃ¡sicas</strong>.
            </p>
            <p class="warning-text" data-i18n-html="deleteAllDataNotice">
              <strong>ğŸš¨ NO HAY FORMA DE RECUPERAR LOS CÃ“DIGOS UNA VEZ ELIMINADOS</strong>
            </p>
            <button id="clear-all-data" class="btn-danger" data-i18n="deleteAllDataBtn">ğŸ—‘ï¸ Eliminar Todos los Datos</button>
          </div>

          <!-- Factory Reset Zone -->
          <div class="factory-reset-box">
            <h4 data-i18n="factoryResetSectionTitle">ğŸ”„ Reset Completo de la AplicaciÃ³n</h4>
            <p class="factory-reset-text" data-i18n-html="factoryResetDescription">
              Esta acciÃ³n <strong>RESETEA COMPLETAMENTE</strong> la aplicaciÃ³n, eliminando:
            </p>
            <ul class="factory-reset-list">
              <li data-i18n="factoryResetItems.password">ğŸ” ContraseÃ±a maestra configurada</li>
              <li data-i18n="factoryResetItems.codes">ğŸ—‘ï¸ Todos los cÃ³digos 2FA y datos</li>
              <li data-i18n="factoryResetItems.settings">âš™ï¸ Todas las configuraciones y preferencias</li>
              <li data-i18n="factoryResetItems.history">ğŸ’¾ Todo el historial y cachÃ© local</li>
            </ul>
            <p class="factory-reset-text" data-i18n-html="factoryResetFinalWarning">
              <strong>ğŸš¨ LA APLICACIÃ“N VOLVERÃ AL ESTADO INICIAL COMO SI NUNCA SE HUBIERA USADO</strong>
            </p>
            <button id="factory-reset" class="btn-factory-reset" data-i18n="factoryResetBtn">ğŸ”„ Reset Completo</button>
          </div>
        </div>
      </div>

      <!-- Manual Add Section -->
      <div id="manual-add-section" class="section hidden">
        <h3 data-i18n="manualAddTitle">â• AÃ±adir CÃ³digo Manualmente</h3>
        <form id="manual-add-form">
          <input type="text" id="manual-issuer" data-i18n="servicePlaceholder" placeholder="Servicio (ej: Google, GitHub)" required>
          <input type="text" id="manual-label" data-i18n="accountPlaceholder" placeholder="Cuenta (ej: user@gmail.com)" required>
          <input type="text" id="manual-secret" data-i18n="secretPlaceholder" placeholder="CÃ³digo secreto (Base32)" required>
          <div class="advanced-options">
            <label>
              <span data-i18n="algorithmLabel">Algoritmo:</span> 
              <select id="manual-algorithm">
                <option value="SHA1" data-i18n="sha1Standard">SHA1 (estÃ¡ndar)</option>
                <option value="SHA256">SHA256</option>
                <option value="SHA512">SHA512</option>
              </select>
            </label>
            <label>
              <span data-i18n="digitsLabel">DÃ­gitos:</span> 
              <select id="manual-digits">
                <option value="6" data-i18n="sixStandard">6 (estÃ¡ndar)</option>
                <option value="8">8</option>
              </select>
            </label>
            <label>
              <span data-i18n="periodLabel">PerÃ­odo:</span> 
              <input type="number" id="manual-period" value="30" min="15" max="300">s
            </label>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary" data-i18n="addCodeBtn">âœ… AÃ±adir CÃ³digo</button>
            <button type="button" id="cancel-manual" class="btn-secondary" data-i18n="cancelBtn">âŒ Cancelar</button>
          </div>
        </form>
      </div>

    </section>

  </main>

  <!-- Security verification panel (dev mode) -->
  <div id="security-panel" class="security-panel">
    <h4 data-i18n="securityVerification">ğŸ” VerificaciÃ³n de Seguridad</h4>
    <div id="security-checks"></div>
  </div>

  <script type="module" src="./js/main.js"></script>
</body>
</html>